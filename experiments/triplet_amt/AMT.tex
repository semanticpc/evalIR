\documentclass[prodmode,acmtecs]{reports}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

% Package to generate and customize Algorithm as per ACM style
\usepackage[ruled]{algorithm2e}
\renewcommand{\algorithmcfname}{ALGORITHM}
\SetAlFnt{\small}
\SetAlCapFnt{\small}
\SetAlCapNameFnt{\small}
\SetAlCapHSkip{0pt}
\IncMargin{-\parindent}


\usepackage[square,comma]{natbib}

% Metadata Information
\acmVolume{}
\acmNumber{}
\acmArticle{}
\acmYear{}
\acmMonth{}

% Document starts
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}

% Page heads
\markboth{Praveen Chandar}{Triplet Judgments using Mechanical Turk}

% Title portion
\title{Triplet Judgments using Mechanical Turk}
\author{Praveen Chandar
\affil{University of Delaware}}

\begin{abstract}

\end{abstract}

%\category{C.2.2}{Computer-Communication Networks}{Network Protocols}

%\terms{Design, Algorithms, Performance}

%\keywords{Wireless sensor networks, media access control,multi-channel, radio interference, time synchronization}

%\acmformat{}

%\begin{bottomstuff}
%\end{bottomstuff}

\maketitle


\section{Introduction}



The various steps involved are as follows:
\begin{bulletlist}
\item Document Pooling 
\item Generate and Sample triplets
\item Create HITs
\item Set Qualifications
\item Submit HITs
\end{bulletlist}


\section{Document Pooling}
The \emph{evalIR} package has a function to pool documents at a specified depth given a list of runs in TREC format. 
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(evalIR,} \hlkwc{quietly}\hlstd{=T)}
\hlkwd{library}\hlstd{(plyr)}
\hlstd{trec09} \hlkwb{<-} \hlkwd{list.files}\hlstd{(}\hlkwc{path}\hlstd{=}\hlstr{'../demo/data/diversity/trec2009'}\hlstd{,} \hlkwc{full.names}\hlstd{=T)}
\hlstd{trec09_runids} \hlkwb{<-} \hlkwd{basename}\hlstd{(trec09)}
\hlstd{pooling_depth} \hlkwb{=} \hlnum{5}
\hlstd{runs} \hlkwb{<-} \hlkwd{read.runs}\hlstd{(}\hlkwc{runPaths}\hlstd{= trec09,}
                  \hlkwc{runids}\hlstd{= trec09_runids,}
                  \hlkwc{limit}\hlstd{= pooling_depth)}
\hlstd{topK_pooling} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{,} \hlkwc{pooling_depth}\hlstd{=}\hlnum{5}\hlstd{)\{}
  \hlstd{pooled_docs} \hlkwb{<-} \hlkwd{pooling.topk}\hlstd{(runs}\hlopt{$}\hlkwd{getRankMatrix}\hlstd{(x}\hlopt{$}\hlstd{query), pooling_depth)}
  \hlkwd{return}\hlstd{(}\hlkwd{data.frame}\hlstd{(}\hlkwc{docID}\hlstd{=}\hlkwd{names}\hlstd{(pooled_docs)))}
\hlstd{\}}
\hlstd{pooled_docs} \hlkwb{<-} \hlkwd{adply}\hlstd{(}\hlkwd{data.frame}\hlstd{(}\hlkwc{query}\hlstd{=runs}\hlopt{$}\hlkwd{getQueries}\hlstd{()),} \hlnum{1}\hlstd{, topK_pooling)}
\hlkwd{head}\hlstd{(pooled_docs,} \hlkwc{n}\hlstd{=}\hlnum{5}\hlstd{)}
\end{alltt}
\begin{verbatim}
##   query                     docID
## 1     1 clueweb09-en0001-02-21652
## 2     1 clueweb09-en0010-57-32918
## 3     1 clueweb09-en0010-79-02218
## 4     1 clueweb09-en0010-93-11767
## 5     1 clueweb09-en0025-89-06994
\end{verbatim}
\end{kframe}
\end{knitrout}



\section{Generate and Sample Triplets }


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{generate_triplets} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{,} \hlkwc{pooled_docs}\hlstd{)\{}
  \hlstd{documents} \hlkwb{<-} \hlkwd{subset}\hlstd{(pooled_docs, query} \hlopt{==} \hlstd{x)}
  \hlstd{documents}\hlopt{$}\hlstd{docID} \hlkwb{<-} \hlkwd{as.character}\hlstd{(documents}\hlopt{$}\hlstd{docID)}
  \hlstd{doc_ids} \hlkwb{<-} \hlstd{documents}\hlopt{$}\hlstd{docID}
  \hlstd{triplets} \hlkwb{<-} \hlkwd{ddply}\hlstd{(documents,}
                    \hlkwd{.}\hlstd{(docID),}
                    \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)}
                      \hlkwd{t}\hlstd{(}\hlkwd{combn}\hlstd{(doc_ids[}\hlopt{!}\hlstd{doc_ids} \hlopt{%in%} \hlkwd{c}\hlstd{(x}\hlopt{$}\hlstd{docID)],}\hlnum{2}\hlstd{)))}
  \hlkwd{colnames}\hlstd{(triplets)} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlstr{'top_doc'}\hlstd{,}\hlstr{'left_doc'}\hlstd{,}\hlstr{'right_doc'}\hlstd{)}
  \hlkwd{return}\hlstd{(triplets)}
\hlstd{\}}
\hlstd{triplets} \hlkwb{<-} \hlkwd{ddply}\hlstd{(}\hlkwd{data.frame}\hlstd{(}\hlkwc{query}\hlstd{=runs}\hlopt{$}\hlkwd{getQueries}\hlstd{()),}
                  \hlkwd{.}\hlstd{(query),}
                  \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)} \hlkwd{generate_triplets}\hlstd{((x}\hlopt{$}\hlstd{query), pooled_docs))}
\end{alltt}
\end{kframe}
\end{knitrout}


\section{Create HITs}

\emph{MTurkR} can be used to automatically submit jobs from R to Amazon Mechanical Turk. 

\end{document}
